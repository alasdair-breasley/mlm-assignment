---
title: "Title of your report"
author: "fmcv76"
date: "01/03/24"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = TRUE)

```

## Initial Data Loading and Checks 

```{r include = FALSE}

library(lme4)
library(lmerTest)
library(ggplot2)
library(scales)
library(sjPlot)
library(tidyverse)
library(tinytex)
library(wordcountaddin)

```

```{r}

# Load data 
crt_data = read.csv("https://andygolightly.github.io/teaching/MATH43515/CRT.csv", 
                    header = TRUE)

# Preprocess data 
crt_data = crt_data %>% 
  dplyr::rename(Class = class) %>% 
  dplyr::mutate(Pupil = as.factor(Pupil),
                School = as.factor(School),
                Intervention = as.factor(Intervention),
                FSM = as.factor(FSM),
                Class = as.factor(Class))

# Check for NAs 
colSums(is.na(crt_data))

```

## Introduction 

- Randomised Control Trials (RCTs) are used to assess the effectiveness of an intervention. Individuals are randomly assigned to either the treatment or control group and this aims to prevent systematic differences between intervention groups with regards to both observables and unobservables, preventing selection into treatment bias. 
- In an educational setting, it may be neither practical nor ethical to administer an intervention at the Pupil or Class level. Providing an intervention at the Pupil level may not be practical or ethical given it would be practically challenging and could be seen as immoral for a teacher to provide some Pupils within a single Class with an intervention and not others. Providing an intervention at the Class level may be more practical than at the Pupil level but may still not be ethical as it could be seen as immoral for a School to provide Pupils in one Class with an intervention and not others. 
- This is where Cluster Randomised Control Trials (CRCTs) are useful. A CRCT in an educational setting can allow for an intervention to be administered at the School level, with less practical and ethical issues. Schools are randomly assigned to either the treatment or control group. 
- This report will assess the results of a 3-level educational CRCT. 20 Schools were randomly assigned to either the control or treatment group, with the treatment group receiving an educational intervention to try and improve Pupils test performance. Pupils test scores were calculated for 2 Classes per School, with test scores calculated both pre and post educational intervention. It is not clear how the initial 20 Schools were selected from the wider population of Schools in the country so there may be selection into experiment bias present. It is not clear whether any Pupils dropped out of the study or not so there may be selection into observation bias present, with evidence of this being the absence of Pupil IDs 256, 257 and 258. 
- The variables collected as part of the CRCT were:
  - __Pupil__ - Anonymised Pupil ID. 
  - __Class__ - Anonymised Class ID. 
  - __School__ - Anonymised School ID. 
  - __Intervention__ - Flag indicating whether a Pupil is in the control or treatment. 
  - __FSM__ - Flag indicating whether a Pupil is eligible for free school meals. 
  - __Pretest__ - A pre-intervention test score for each Pupil. 
  - __Posttest__ - A post-intervention test score for each Pupil. 
- The 3-level structure of the data is as follows: Pupils nested within Classes nested within Schools. 
- The covariates at the Pupil level are: FSM and Pretest. 
- There are no covariates at the Class level. 
- The covariate at the School level is: Intervention. 

```{r}

# Distribution of Pretest scores by intervention group histogram 
ggplot(data = crt_data, aes(x = Pretest, fill = Intervention)) +
  geom_histogram(aes(y = ..count..), binwidth = 1, colour = "black", position = "identity", alpha = 0.3) +
  scale_fill_manual(values = c("1" = "red", "0" = "blue")) +
  scale_x_continuous(breaks = breaks_width(1), minor_breaks = NULL) +
  scale_y_continuous(breaks = breaks_width(10)) +
  labs(x = "Prestest Scores", y = "Count", title = "Distribution of Pretest Scores Overlaid by Intervention Group") +
  theme(panel.border = element_rect(colour = "black", fill = NA, size = 0.5), axis.text = element_text(color = "black", size = 12),
        axis.title = element_text(size = 14), plot.title = element_text(size = 14, face = "bold"))

```

## Word Count

```{r warning = FALSE, include = FALSE}

n_words = paste0("Word Count: ", as.character(word_count()))

```

```{r echo = FALSE}

print(n_words)

```
